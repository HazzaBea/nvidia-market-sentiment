<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVIDIA Market Sentiment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sentiment-indicator {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">NVIDIA (NVDA) Market Sentiment</h1>
            <p id="lastUpdated" class="text-gray-600">Last updated: ...</p>
        </header>

        <!-- Stock Price and Sentiment Overview -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="grid grid-cols-2 gap-4">
                <!-- Stock Price -->
                <div class="text-center">
                    <h2 class="text-xl font-semibold text-gray-700 mb-2">Current Price</h2>
                    <div id="stockPrice" class="text-3xl font-bold text-green-600">Loading...</div>
                </div>
                <!-- Overall Sentiment -->
                <div class="text-center">
                    <h2 class="text-xl font-semibold text-gray-700 mb-2">Market Sentiment</h2>
                    <div id="overallSentiment" class="text-3xl font-bold">Loading...</div>
                    <div id="sentimentIndicator" class="sentiment-indicator h-4 rounded-full bg-gray-200 mt-2"></div>
                </div>
            </div>
        </div>

        <!-- News Headlines -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Recent News Headlines</h2>
            <div id="newsContainer" class="space-y-4">
                <p class="text-gray-600">Loading headlines...</p>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden mt-4 p-4 bg-red-100 text-red-700 rounded-lg"></div>
    </div>

    <script type="module">
        import config from './config.js';

        // Main functions
        async function fetchStockPrice() {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=NVDA&token=${config.FINNHUB_API_KEY}`);
                const data = await response.json();
                if (data.c) {
                    document.getElementById('stockPrice').textContent = `$${data.c.toFixed(2)}`;
                } else {
                    throw new Error('Unable to fetch stock price');
                }
            } catch (error) {
                showError('Failed to fetch stock price');
            }
        }

        async function fetchNewsAndSentiment() {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/company-news?symbol=NVDA&from=${getDateString()}&to=${getDateString()}&token=${config.FINNHUB_API_KEY}`);
                const news = await response.json();
                
                if (Array.isArray(news) && news.length > 0) {
                    const newsContainer = document.getElementById('newsContainer');
                    newsContainer.innerHTML = ''; // Clear loading message
                    
                    let totalSentiment = 0;
                    const newsToDisplay = news.slice(0, 5); // Display only 5 most recent news
                    
                    newsToDisplay.forEach(article => {
                        // Simple sentiment calculation (this should be replaced with actual sentiment API data)
                        const sentiment = Math.random() * 2 - 1; // Mock sentiment between -1 and 1
                        totalSentiment += sentiment;
                        
                        const articleElement = document.createElement('div');
                        articleElement.className = 'p-4 border rounded hover:bg-gray-50';
                        articleElement.innerHTML = `
                            <h3 class="font-semibold mb-1">${article.headline}</h3>
                            <p class="text-sm text-gray-600">${new Date(article.datetime * 1000).toLocaleDateString()}</p>
                            <div class="mt-2">
                                <span class="px-2 py-1 rounded text-sm ${getSentimentClass(sentiment)}">
                                    ${getSentimentLabel(sentiment)}
                                </span>
                            </div>
                        `;
                        newsContainer.appendChild(articleElement);
                    });

                    updateOverallSentiment(totalSentiment / newsToDisplay.length);
                } else {
                    throw new Error('No news available');
                }
            } catch (error) {
                showError('Failed to fetch news');
            }
        }

        function updateOverallSentiment(sentimentScore) {
            const sentimentElement = document.getElementById('overallSentiment');
            const indicatorElement = document.getElementById('sentimentIndicator');
            
            // Update text
            const label = getSentimentLabel(sentimentScore);
            sentimentElement.textContent = label;
            
            // Update indicator
            const percentage = ((sentimentScore + 1) / 2) * 100; // Convert -1 to 1 range to 0-100
            indicatorElement.style.background = `linear-gradient(to right, #ef4444 0%, #eab308 50%, #22c55e 100%)`;
            indicatorElement.style.position = 'relative';
            indicatorElement.innerHTML = `<div class="absolute w-2 h-full bg-black" style="left: ${percentage}%"></div>`;
        }

        // Utility functions
        function getDateString() {
            const date = new Date();
            return date.toISOString().split('T')[0];
        }

        function getSentimentLabel(score) {
            if (score > 0.3) return 'Bullish';
            if (score < -0.3) return 'Bearish';
            return 'Neutral';
        }

        function getSentimentClass(score) {
            if (score > 0.3) return 'bg-green-100 text-green-800';
            if (score < -0.3) return 'bg-red-100 text-red-800';
            return 'bg-yellow-100 text-yellow-800';
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchStockPrice();
            fetchNewsAndSentiment();
            document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;
            
            // Refresh data every 5 minutes
            setInterval(() => {
                fetchStockPrice();
                fetchNewsAndSentiment();
                document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;
            }, 300000);
        });
    </script>
</body>
</html>
